<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shopping website - Admin</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
      integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <!-- HEADER -->
    <header>
      <div class="logo">
        <a href="#"><img src="/assets/images/logo.png" alt="logo" /></a>
      </div>

      <nav class="header__navbar">
        <ul>
          <li><a href="#">HOME</a></li>
          <li><a href="#">PRODUCT</a></li>
          <li><a href="order.administration.html">ORDER</a></li>
          <li><a href="#">ABOUT</a></li>
        </ul>
      </nav>

      <div class="header__account">
        <i class="fa fa-user"></i>
        <p id="accountname"></p>
        <button id="logoutBtn">Logout</button>
      </div>
    </header>

    <br />
    <form class="searchbar" action="index_administration.html">
      <input
        id="searchInput"
        type="text"
        placeholder="Search.."
        name="search"
      />
      <button type="button" onclick="handleSearch()">
        <i class="fa fa-search"></i>
      </button>
    </form>

    <br />
    <br />

    <button class="btn-add" onclick="openModal()">Add new product</button>

    <br />
    <br />

    <!-- BODY -->

    <section id="productList" class="product-list"></section>

    <!-- Modal -->
    <div id="productModal" class="modal">
      <div class="modal-content">
        <h3>Product Information</h3>
        <label>ID</label><input id="id" placeholder="ID" disabled />
        <label>Name</label><input id="name" placeholder="Name" />
        <label>Description</label
        ><input id="description" placeholder="Description" />
        <label>Price</label><input id="price" placeholder="Price" />
        <label>Quantity</label><input id="quantity" placeholder="Quantity" />
        <label>Image</label><input id="image" placeholder="Image URL" />
        <div>
          <button onclick="saveProduct()">Save</button>
          <button class="delete" onclick="deleteProduct()">Delete</button>
          <button onclick="closeModal()">Cancel</button>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer>
      <div class="copyright">
        <p>Copyright &copy; 2025 All rights reserved</p>
        <a href="#">BANANAS</a>
      </div>
    </footer>

    <!-- SCRIPT -->
    <script>
      // AUTHORIZATION

      window.addEventListener("DOMContentLoaded", () => {
        const username = localStorage.getItem("username");
        const accountName = document.getElementById("accountname");
        const logoutBtn = document.getElementById("logoutBtn");

        if (!username) {
          alert("Bạn chưa đăng nhập!");
          window.location.href = "login.html";
          return;
        }

        accountName.textContent = username;

        logoutBtn.addEventListener("click", () => {
          localStorage.removeItem("username");
          localStorage.removeItem("isLoggedIn");
          window.location.href = "index_user.html";
        });
      });

      // PRODUCTS

      class Product {
        constructor(id, image, name, description, price, quantity) {
          this.id = id;
          this.image = image;
          this.name = name;
          this.description = description;
          this.price = price;
          // this.quantity = quantity;
          this.sizes = sizes;
          let stock = 0;
          for (let size in sizes) {
            stock += sizes[size];
          }
          this.quantity = stock;
        }
      }

      let products = new Array();

      function main() {
        initData();
        displayProducts();
      }
      main();

      function initData() {
        products = [
          new Product(
            1,
            "/assets/images/basas_hightop.jpg",
            "BASAS HIGHTOP",
            "BASAS cổ cao",
            "600,000",
            // 25,
            {
              40: 5,
              41: 10,
              42: 10,
            }
          ),
          new Product(
            2,
            "/assets/images/basas_lowtop.jpg",
            "BASAS LOWTOP",
            "BASAS cổ thấp",
            "450,000",
            // 25,
            {
              40: 5,
              41: 10,
              42: 10,
            }
          ),
          new Product(
            3,
            "/assets/images/basas_midtop.jpeg",
            "BASAS MIDTOP",
            "BASAS cổ vừa",
            "550,000",
            // 25,
            {
              40: 5,
              41: 10,
              42: 10,
            }
          ),
          new Product(
            4,
            "/assets/images/denim_hightop.jpg",
            "DENIM HIGHTOP",
            "DENIM cổ cao",
            "600,000",
            // 25,
            {
              40: 5,
              41: 10,
              42: 10,
            }
          ),
          new Product(
            5,
            "/assets/images/denim_lowtop_.jpg",
            "DENIM LOWTOP",
            "DENIM cổ thấp",
            "450,000",
            // 25,
            {
              40: 5,
              41: 10,
              42: 10,
            }
          ),
          new Product(
            6,
            "/assets/images/denim_midtop.jpg",
            "DENIM MIDTOP",
            "DENIM cổ vừa",
            "550,000",
            // 25,
            {
              40: 5,
              41: 10,
              42: 10,
            }
          ),
          new Product(
            7,
            "/assets/images/vintas_hightop.jpeg",
            "VINTAS HIGHTOP",
            "VINTAS cổ cao",
            "600,000",
            // 25,
            {
              40: 5,
              41: 10,
              42: 10,
            }
          ),
          new Product(
            8,
            "/assets/images/vintas_lowtop.jpeg",
            "VINTAS LOWTOP",
            "VINTAS cổ thấp",
            "450,000",
            // 25,
            {
              40: 5,
              41: 10,
              42: 10,
            }
          ),
          new Product(
            9,
            "/assets/images/vintas_midtop.jpg",
            "VINTAS MIDTOP",
            "VINTAS cổ vừa",
            "550,000",
            // 25,
            {
              40: 5,
              41: 10,
              42: 10,
            }
          ),
        ];
      }

      function displayProducts(list = products) {
        let container = document.getElementById("productList");
        let items = "";

        for (let i = 0; i < list.length; i++) {
          items += `
      <div class="product-item" onclick="openModal(${i})">
        <img src="${list[i].image}" alt="" />
        <div class="product-info">
          <h3>${list[i].name}</h3>
          <p>${list[i].price} VND</p>
          <button class="btn">View Product</button>
        </div>
      </div>`;
        }

        container.innerHTML = items;
      }

      // MODAL
      let editingIndex = null;

      function openModal(index = null) {
        const modal = document.getElementById("productModal");
        modal.style.display = "flex";

        const deleteBtn = document.querySelector("#productModal .delete");

        if (index !== null) {
          // chỉnh sửa sản phẩm
          editingIndex = index;
          const p = products[index];
          document.getElementById("id").value = p.id;
          document.getElementById("name").value = p.name;
          document.getElementById("description").value = p.description;
          document.getElementById("price").value = p.price;
          document.getElementById("quantity").value = p.quantity;
          document.getElementById("image").value = p.image;
          deleteBtn.style.display = "inline-block";
        } else {
          // thêm sản phẩm mới
          editingIndex = null;
          document.getElementById("id").value = products.length + 1;
          document.getElementById("name").value = "";
          document.getElementById("description").value = "";
          document.getElementById("price").value = "";
          document.getElementById("quantity").value = "";
          document.getElementById("image").value = "";
          deleteBtn.style.display = "none";
        }
      }

      function closeModal() {
        document.getElementById("productModal").style.display = "none";
      }

      // Lưu sản phẩm (Add / Edit)
      function saveProduct() {
        const id = document.getElementById("id").value;
        const name = document.getElementById("name").value;
        const description = document.getElementById("description").value;
        const price = document.getElementById("price").value;
        const quantity = document.getElementById("quantity").value;
        const image = document.getElementById("image").value;

        if (editingIndex !== null) {
          // Edit
          products[editingIndex] = {
            id,
            name,
            description,
            price,
            quantity,
            image,
          };
        } else {
          // Add new
          products.unshift({ id, name, description, price, quantity, image });
        }
        localStorage.setItem("products", JSON.stringify(products));
        displayProducts();
        closeModal();
      }

      function deleteProduct() {
        if (editingIndex !== null) {
          products.splice(editingIndex, 1);
          localStorage.setItem("products", JSON.stringify(products));
          displayProducts();
          closeModal();
        }
      }

      // SEARCH

      function handleSearch() {
        let keyword = document
          .getElementById("searchInput")
          .value.toLowerCase();
        let result = products.filter((p) =>
          p.name.toLowerCase().includes(keyword)
        );
        displayProducts(result);
      }

      localStorage.setItem("products", JSON.stringify(products));
    </script>
  </body>
</html>
