<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
      integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- HEADER -->
    <header>
      <div class="logo">
        <a href="#"><img src="/assets/images/logo.png" alt="logo" /></a>
      </div>

      <nav class="header__navbar">
        <ul>
          <li><a href="index_administration.html">HOME</a></li>
          <li><a href="index_administration.html">PRODUCT</a></li>
          <li><a href="#">ORDER</a></li>
          <li><a href="#">ABOUT</a></li>
        </ul>
      </nav>

      <div class="header__info">
        <i class="fa fa-search"></i>
        <a class="cart" href="#">
          <p class="cart-item">0</p>
          <i class="fa fa-shopping-cart"></i>
        </a>

        <div class="header__account">
          <i class="fa fa-user"></i>
          <p id="accountname"></p>
          <button id="logoutBtn">Logout</button>
        </div>
      </div>
    </header>

    <!-- BODY  -->

    <div id="adminOrderList"></div>

    <!-- FOOTER -->
    <footer>
      <div class="copyright">
        <p>Copyright &copy; 2025 All rights reserved</p>
        <a href="#">BANANAS</a>
      </div>
    </footer>

    <script>
      // AUTHORIZATION

      window.addEventListener("DOMContentLoaded", () => {
        const username = localStorage.getItem("username");
        const accountName = document.getElementById("accountname");
        const logoutBtn = document.getElementById("logoutBtn");

        if (!username) {
          alert("Bạn chưa đăng nhập!");
          window.location.href = "login.html";
          return;
        }

        accountName.textContent = username;

        logoutBtn.addEventListener("click", () => {
          localStorage.removeItem("username");
          localStorage.removeItem("isLoggedIn");
          window.location.href = "index_user.html";
        });
      });

      // ORDERS

      window.onload = function () {
        let orders = JSON.parse(localStorage.getItem("orders")) || [];
        let totalPrice = parseInt(localStorage.getItem("totalPrice"));

        const container = document.getElementById("adminOrderList");

        if (orders.length === 0) {
          container.innerHTML = "<p>Chưa có đơn hàng nào.</p>";
          return;
        }

        for (let order of orders) {
          const div = document.createElement("div");
          let itemsHTML = "";

          for (let item of order.items) {
            itemsHTML += `<p>${item.name} x ${item.quantity} = ${item.price}</p>`;
          }

          div.innerHTML = `
      <h3>Đơn #${order.id}</h3>
      <p>Người nhận: ${order.receiver}</p>
      <p>Địa chỉ: ${order.address}</p>
      <p>SĐT: ${order.phone}</p>
      <div>${itemsHTML}</div>
      <p>Tổng tiền: ${totalPrice.toLocaleString()} VND</p>
      <label>Status:</label>
      <select onchange="updateStatus(${order.id}, this.value)">
        <option value="Đã đặt hàng" ${
          order.status === "Đã đặt hàng" ? "selected" : ""
        }>Đã đặt hàng</option>
        <option value="Đã lên đơn" ${
          order.status === "Đã lên đơn" ? "selected" : ""
        }>Đã lên đơn</option>
        <option value="Đang vận chuyển" ${
          order.status === "Đang vận chuyển" ? "selected" : ""
        }>Đang vận chuyển</option>
        <option value="Đã hủy" ${
          order.status === "Đã hủy" ? "selected" : ""
        }>Đã hủy</option>      
        </select>    
        `;
          container.appendChild(div);
        }
      };

      function updateStatus(id, newStatus) {
        const orders = JSON.parse(localStorage.getItem("orders")) || [];
        const order = orders.find((o) => o.id === id);
        if (!order) return;

        order.status = newStatus;
        localStorage.setItem("orders", JSON.stringify(orders));
      }
    </script>
  </body>
</html>
